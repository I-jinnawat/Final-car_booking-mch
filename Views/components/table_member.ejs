<div class="card mt-3" style="box-shadow: 0px 8px 24px 0px rgba(0, 0, 0, 0.25);">
    <table class="table table-striped table-hover table-bordered">
        <thead>
            <tr>
                <th scope="col">จัดการ</th>
                <th scope="col">ประเภท</th>
                <th scope="col">รหัส</th>
                <th scope="col">ชื่อ</th>
                <th scope="col">หน่วยงาน</th>
            </tr>
        </thead>
        <tbody>
            <% users.forEach(USER=> { %>
                <tr>
                    <td>
                        <div class="btn-group" role="group" style="width: 75px;">
                            <button class="btn btn-warning" data-bs-toggle="modal"
                                data-bs-target="#UpdateInfo_<%= USER._id %>">
                                <i class="fa-regular fa-pen-to-square"></i>
                            </button>
                            <button class="btn btn-danger" onclick="displayAlert('<%= USER._id %>')">
                                <i class="fa-solid fa-trash-can"></i>
                            </button>
                        </div>
                    </td>
                    <td>
                        <%= USER.role==='approver' ? 'ผู้อนุมัติ' : USER.role==='admin' ? 'ผู้จัดรถ' :
                            USER.role==='driver' ? 'พนักงานขับรถ' : 'พนักงาน' %>
                    </td>
                    <td>
                        <%= USER.numberID %>
                    </td>
                    <td>
                        <%= USER.firstname %>
                            <%= USER.lastname %>
                    </td>
                    <td>
                        <%= USER.organization %>
                    </td>
                </tr>
                <div class="modal fade" id="UpdateInfo_<%= USER._id %>" aria-hidden="true" tabindex="-1">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">แก้ไขข้อมูลสมาชิก</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <form action="/setting/member/update/<%= USER._id %>" method="POST">
                                    <div class="mb-3 row">
                                        <label class="col-sm-3 col-form-label">ประเภท</label>
                                        <div class="col-sm-9">
                                            <select name="role" class="form-select">
                                                <option value="approver" <%=USER.role==='approver' ? 'selected' : '' %>
                                                    >ผู้อนุมัติ</option>
                                                <option value="admin" <%=USER.role==='admin' ? 'selected' : '' %>
                                                    >ผู้จัดรถ</option>
                                                <option value="user" <%=USER.role==='user' ? 'selected' : '' %>>พนักงาน
                                                </option>
                                                <option value="driver" <%=USER.role==='driver' ? 'selected' : '' %>
                                                    >พนักงานขับรถ</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <label class="col-sm-3 col-form-label">รหัสพนักงาน</label>
                                        <div class="col-sm-9">
                                            <input name="numberID" id="NumberIDInput_<%= USER._id %>" type="text"
                                                class="form-control" value="<%= USER.numberID %>" disabled>
                                            <div class="form-check mt-2">
                                                <input class="form-check-input" type="checkbox"
                                                    id="enableNumberID_<%= USER._id %>">
                                                <label class="form-check-label"
                                                    for="enableNumberID_<%= USER._id %>">ต้องการเปลี่ยนรหัสพนักงาน</label>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <label class="col-sm-3 col-form-label">ชื่อ</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="firstname"
                                                value="<%= USER.firstname %>" required>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <label class="col-sm-3 col-form-label">นามสกุล</label>
                                        <div class="col-sm-9">
                                            <input type="text" class="form-control" name="lastname"
                                                value="<%= USER.lastname %>" required>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <label class="col-sm-3 col-form-label">หน่วยงาน</label>
                                        <div class="col-sm-9">
                                            <select name="organization" class="form-select" required>
                                                <option value="สำนักงานเลขานุการศูนย์การแพทย์มหาวิทยาลัยแม่ฟ้าหลวง"
                                                    <%=USER.organization==='สำนักงานเลขานุการศูนย์การแพทย์มหาวิทยาลัยแม่ฟ้าหลวง'
                                                    ? 'selected' : '' %>
                                                    >สำนักงานเลขานุการศูนย์การแพทย์มหาวิทยาลัยแม่ฟ้าหลวง</option>
                                                <option value="โรงพยาบาลศูนย์การแพทย์มหาวิทยาลัยแม่ฟ้าหลวง"
                                                    <%=USER.organization==='โรงพยาบาลศูนย์การแพทย์มหาวิทยาลัยแม่ฟ้าหลวง'
                                                    ? 'selected' : '' %>>โรงพยาบาลศูนย์การแพทย์มหาวิทยาลัยแม่ฟ้าหลวง
                                                </option>
                                                <option value="โรงพยาบาลมหาวิทยาลัยแม่ฟ้าหลวง เชียงราย"
                                                    <%=USER.organization==='โรงพยาบาลมหาวิทยาลัยแม่ฟ้าหลวง เชียงราย'
                                                    ? 'selected' : '' %>>โรงพยาบาลมหาวิทยาลัยแม่ฟ้าหลวง เชียงราย
                                                </option>
                                                <option
                                                    value="ศูนย์บริการสุขภาพแบบครบวงจรแห่งภาคเหนือ และอนุภูมิภาคลุ่มแม่น้ำโขง"
                                                    <%=USER.organization==='ศูนย์บริการสุขภาพแบบครบวงจรแห่งภาคเหนือ และอนุภูมิภาคลุ่มแม่น้ำโขง'
                                                    ? 'selected' : '' %>>ศูนย์บริการสุขภาพแบบครบวงจรแห่งภาคเหนือ
                                                    และอนุภูมิภาคลุ่มแม่น้ำโขง</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <label class="col-sm-3 col-form-label">วัน/เดือน/ปี เกิด</label>
                                        <div class="col-sm-9">
                                            <input
                                                value="<%= USER.birth_year ? new Date(USER.birth_year).toISOString().split('T')[0] : '' %>"
                                                name="birth_year" id="birthDate" type="date" class="form-control">
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <label class="col-sm-3 col-form-label">รหัสผ่าน</label>
                                        <div class="col-sm-9">
                                            <input name="password" type="password" class="form-control"
                                                id="passwordInput_<%= USER._id %>" disabled>
                                            <div class="form-check mt-2">
                                                <input class="form-check-input" type="checkbox"
                                                    id="enablePassword_<%= USER._id %>">
                                                <label class="form-check-label"
                                                    for="enablePassword_<%= USER._id %>">ต้องการเปลี่ยนรหัส</label>
                                                <i id="passwordVisibilityToggle_<%= USER._id %>" class="bi bi-eye-slash"
                                                    aria-hidden="true"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="text-center">
                                        <button type="submit" id="updatedBtn" class="btn btn-primary">ยืนยัน</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <% }); %>
        </tbody>
    </table>
    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center">
            <li class="page-item <%= currentPage === 1 ? 'disabled' : '' %>">
                <a class="page-link" href="/setting/member?page=<%= currentPage - 1 %>" tabindex="-1"
                    aria-disabled="true">Previous</a>
            </li>
            <% for (let i=1; i <=totalPages; i++) { %>
                <li class="page-item <%= i === currentPage ? 'active' : '' %>">
                    <a class="page-link" href="/setting/member?page=<%= i %>">
                        <%= i %>
                    </a>
                </li>
                <% } %>
                    <li class="page-item <%= currentPage === totalPages ? 'disabled' : '' %>">
                        <a class="page-link" href="/setting/member?page=<%= currentPage + 1 %>">Next</a>
                    </li>
        </ul>
    </nav>
</div>

<script>
    document.querySelectorAll("[id^='enableNumberID_']").forEach(checkbox => {
        checkbox.addEventListener("change", function () {
            toggleNumberIDVisibility(this);
        });
    });

    function toggleNumberIDVisibility(checkbox) {
        var userId = checkbox.id.split("_")[1];
        var NumberIDInput = document.getElementById("NumberIDInput_" + userId);
        NumberIDInput.disabled = !checkbox.checked;
    }
</script>